@page "/CMK/{name:regex(^([a-zA-Z0-9А-Яа-я .&'-]+)$)}"
@using OAT.Components
@using OAT.Controllers.Workers
@using OAT.Utilities
@model CMKModel
@{
    ViewData["Title"] = Model.name;
    using var context = new DatabaseContext();
    var cmk = context.CMK.FirstOrDefault(e => e.name == Model.name);
}
@if(cmk is null)
{
    <h2 class="section-title">
        ЦМК с таким именем не найден
    </h2>
    return;
}

<section class="centered">
	<h2 class="section-title">
		@cmk.name
	</h2>
	
    <ul class="page-navigation">
        <li>
            <a href="#people">
                Состав ЦМК
            </a>
        </li>
        <li>
            <a href="#history">
                История ЦМК
            </a>
        </li>
        <li>
            <a href="#news">
                Новости ЦМК
            </a>
        </li>
        <li>
            <a href="#documents">
                Основная документация
            </a>
        </li>
    </ul>


    <h3 id="people" class="section-subtitle">
        Состав ЦМК
    </h3>
    <ul class="people-list">
        @foreach (var FullName in cmk.compositions)
        {
            var people = WorkersReader.AllWorkers.FirstOrDefault(e => e.FullName.ToSimpleText() == FullName.ToSimpleText());
            if (people is null)
            {
                <li class="people-item">
                    <a class="people-item-img-container" href="">
                        <img src="~/images/basic/unnamed.jpg" alt="">
                    </a>
                    <div class="people-item-body">
                        <div class="people-item-body-fio">
                            @FullName
                        </div>
                        <div class="people-item-body-job">
                            Информация не найдена. Сообщите в отдел кадров
                        </div>
                    </div>
                </li>
            }
            else
            {
                <li class="people-item" >
                    <a class="people-item-img-container" href="/organizationInformation/worker/@people.FullName">
                        <img src="~/images/basic/unnamed.jpg" alt="">
                    </a>
                    <div class="people-item-body">
                        <div class="people-item-body-fio">
                            @people.FullName
                        </div>
                        <div class="people-item-body-job">
                            @people.Post
                        </div>
                    </div>
                </li>
            }
        }
    </ul>

    <h3 id="history" class="section-subtitle">
        История ЦМК
    </h3>

    @foreach (var t in cmk.history.Split("\n"))
    {
        <p>@Html.Raw(@t)</p>
    }

    <h3 id="news" class="section-subtitle">
        Новости
    </h3>
    <p>
        https://www.oat.ru/CMK/@cmk.name/AllNews
    </p>

    <h3 id="documents" class="section-subtitle">
        Основная документация
    </h3>
    <ul class="documents-list little">
        @foreach(var doc in cmk.documents)
        {
            <li class="document-item">
                <div class="document-item-head">
                    <a target="_blank" href="@doc.url">
                    </a>
                </div>
                <div class="document-item-body">
                    @doc.name
                </div>
            </li>
        }
    </ul>



</section>