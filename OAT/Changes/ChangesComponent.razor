@using OAT.Components
@using OAT.Readers;
@using OAT.Utilities;
@using Microsoft.AspNetCore.Components.Rendering;
@using static Enums;

@{
	var hide_css = FakeChangesController.GenerateCSS(10);
	var show_css = FakeChangesController.GenerateCSS(10);
	var fakeCSS = new FakeCSS(show_css, hide_css);
	var url = $"/api/multi/css/{StringUtils.ConvertStringToHex(fakeCSS.toJson())}";
}
<link rel="stylesheet" href="@url" asp-append-version="true">

@foreach (var change in rows)
{
	@if(new Random().Next(0, 1) == 1)
	{
		<tr class="@fakeCSS.hide_css[new Random().Next(0, fakeCSS.hide_css.Count() - 1)]">
			<td>
				@change.cours
			</td>
			<td>
				@change.group
			</td>
			<td>
				@rows[new Random().Next(0, rows.Count() - 1)].was_couple
			</td>
			<td>
				@rows[new Random().Next(0, rows.Count() - 1)].was_cabinet
			</td>
			<td>
				@rows[new Random().Next(0, rows.Count() - 1)].was_discipline
			</td>
			<td>
				@rows[new Random().Next(0, rows.Count() - 1)].was_teacher
			</td>
			<td>
				@rows[new Random().Next(0, rows.Count() - 1)].reason
			</td>
			<td>
				@rows[new Random().Next(0, rows.Count() - 1)].couple
			</td>
			<td>
				@rows[new Random().Next(0, rows.Count() - 1)].cabinet
			</td>
			<td>
				@rows[new Random().Next(0, rows.Count() - 1)].discipline
			</td>
			<td>
				@rows[new Random().Next(0, rows.Count() - 1)].teacher
			</td>
		</tr>
	}
	<tr class="@fakeCSS.show_css[new Random().Next(0, fakeCSS.show_css.Count() - 1)]">
		<td>
			@change.cours
		</td>
		<td>
			@change.group
		</td>
		<td>
			@change.was_couple
		</td>
		<td>
			@change.was_cabinet
		</td>
		<td>
			@change.was_discipline
		</td>
		<td>
			@change.was_teacher
		</td>
		<td>
			@change.reason
		</td>
		<td>
			@change.couple
		</td>
		<td>
			@change.cabinet
		</td>
		<td>
			@change.discipline
		</td>
		<td>
			@change.teacher
		</td>
	</tr>

	<tr class="@fakeCSS.hide_css[new Random().Next(0, fakeCSS.hide_css.Count() - 1)]">
		<td>
			@change.cours
		</td>
		<td>
			@change.group
		</td>
		<td>
			@rows[new Random().Next(0, rows.Count() - 1)].was_couple
		</td>
		<td>
			@rows[new Random().Next(0, rows.Count() - 1)].was_cabinet
		</td>
		<td>
			@rows[new Random().Next(0, rows.Count() - 1)].was_discipline
		</td>
		<td>
			@rows[new Random().Next(0, rows.Count() - 1)].was_teacher
		</td>
		<td>
			@rows[new Random().Next(0, rows.Count() - 1)].reason
		</td>
		<td>
			@rows[new Random().Next(0, rows.Count() - 1)].couple
		</td>
		<td>
			@rows[new Random().Next(0, rows.Count() - 1)].cabinet
		</td>
		<td>
			@rows[new Random().Next(0, rows.Count() - 1)].discipline
		</td>
		<td>
			@rows[new Random().Next(0, rows.Count() - 1)].teacher
		</td>
	</tr>
}
		 
		

@code {


	[Parameter]
	public string? search { get; set; }

	[Parameter]
	public Building corpus { get; set; }

	[Parameter]
	public string sheet { get; set; }

	public List<ChangeRow> rows = new List<ChangeRow>();

	protected override void OnInitialized()
	{
		var all_changes = ChangesController.GetListChanges((int)corpus!);
		var changes = all_changes.FirstOrDefault(e => e.SheetName == sheet) ?? all_changes.Last();
		if (search is null)
			rows = changes.rows.ToList();
		else
			rows = changes.rows.Where(e =>
				ToSearch(e.group ?? "").Contains(ToSearch(search)) ||
				ToSearch(e.teacher ?? "").Contains(ToSearch(search)) ||
				ToSearch(e.was_teacher ?? "").Contains(ToSearch(search))).ToList();

		string ToSearch(string? s)
		{
			if (s is null)
				return "";
			return s.ToLower().Replace(" ", "");
		}
	}

	
}
